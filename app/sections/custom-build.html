<div class="hx" id="custom-build"></div>
<details>
  <summary onclick="location.hash = '#custom-build'">
    <h3><a href="#custom-build">üõ†Ô∏è Create a custom build</a></h3>
  </summary>
  <p>
    Utilize the form below to obtain a custom build of <em>matcha.css</em>.
  </p>
  <p>
    For more intricate customization, consider <a href="https://github.com/lowlighter/matcha/fork" target="_blank">forking</a> and directly patching it.
    Note that <em>matcha.css</em> never utilizes <a href="https://developer.mozilla.org/docs/Web/CSS/important"><code data-hl="css">!important</code></a> rules, ensuring ease of style overriding if necessary.
  </p>
  <form class="matcha-build">
    <fieldset class="styling">
      <legend>
        <label>
          <input type="checkbox" data-for="styling" checked> Styling scopes
        </label>
      </legend>
      <div>
        <label>
          <input type="checkbox" name="styling" value="sectioning" checked> Sectioning<br>
          <small><code data-hl="html">&lt;html&gt;</code> <code data-hl="html">&lt;body&gt;</code> <code data-hl="html">&lt;main&gt;</code> <code data-hl="html">&lt;section&gt;</code> <code data-hl="html">&lt;header&gt;</code> <code data-hl="html">&lt;footer&gt;</code> <code data-hl="html">&lt;aside&gt;</code> <code data-hl="html">&lt;article&gt;</code> <code data-hl="html">&lt;hr&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="navigation" checked> Navigation<br>
          <small><code data-hl="html">&lt;menu&gt;</code> <code data-hl="html">&lt;nav&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="headings" checked> Headings<br>
          <small><code data-hl="html">&lt;hgroup&gt;</code> <code data-hl="html">&lt;h1&gt;</code> <code data-hl="html">&lt;h2&gt;</code> <code data-hl="html">&lt;h3&gt;</code> <code data-hl="html">&lt;h4&gt;</code> <code data-hl="html">&lt;h5&gt;</code> <code data-hl="html">&lt;h6&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="flow" checked> Flow<br>
          <small><code data-hl="html">&lt;p&gt;</code> <code data-hl="html">&lt;blockquote&gt;</code> <code data-hl="html">&lt;pre&gt;</code> <code data-hl="html">&lt;figure&gt;</code> <code data-hl="html">&lt;figcaption&gt;</code></small>
        </label>
      </div>
      <div>
        <label>
          <input type="checkbox" name="styling" value="collapsibles" checked> Collapsibles<br>
          <small><code data-hl="html">&lt;details&gt;</code> <code data-hl="html">&lt;summary&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="modals" checked> Modals<br>
          <small><code data-hl="html">&lt;dialog&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="anchors" checked> Anchors<br>
          <small><code data-hl="html">&lt;a&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="abbreviations" checked> Abbreviations<br>
          <small><code data-hl="html">&lt;abbr&gt;</code></small>
        </label>
      </div>
      <div>
        <label>
          <input type="checkbox" name="styling" value="styling" checked> Styling and emphasis<br>
          <small><code data-hl="html">&lt;b&gt;</code> <code data-hl="html">&lt;i&gt;</code> <code data-hl="html">&lt;u&gt;</code> <code data-hl="html">&lt;s&gt;</code> <code data-hl="html">&lt;q&gt;</code> <code data-hl="html">&lt;cite&gt;</code> <code data-hl="html">&lt;dfn&gt;</code> <code data-hl="html">&lt;em&gt;</code> <code data-hl="html">&lt;strong&gt;</code> <code data-hl="html">&lt;small&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="annotations" checked> Annotations<br>
          <small><code data-hl="html">&lt;ruby&gt;</code> <code data-hl="html">&lt;rp&gt;</code> <code data-hl="html">&lt;rt&gt;</code> <code data-hl="html">&lt;sup&gt;</code> <code data-hl="html">&lt;sub&gt;</code> <code data-hl="html">&lt;mark&gt;</code> <code data-hl="html">&lt;ins&gt;</code> <code data-hl="html">&lt;del&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="computing" checked> Computing<br>
          <small><code data-hl="html">&lt;code&gt;</code> <code data-hl="html">&lt;var&gt;</code> <code data-hl="html">&lt;kbd&gt;</code> <code data-hl="html">&lt;samp&gt;</code> <code data-hl="html">&lt;output&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="forms" checked> Forms<br>
          <small><code data-hl="html">&lt;form&gt;</code> <code data-hl="html">&lt;button&gt;</code> <code data-hl="html">&lt;label&gt;</code> <code data-hl="html">&lt;fieldset&gt;</code> <code data-hl="html">&lt;legend&gt;</code> <code data-hl="html">&lt;input&gt;</code> <code data-hl="html">&lt;select&gt;</code> <code data-hl="html">&lt;textarea&gt;</code></small>
        </label>
      </div>
      <div>
        <label>
          <input type="checkbox" name="styling" value="bars" checked> Bars<br>
          <small><code data-hl="html">&lt;progress&gt;</code> <code data-hl="html">&lt;meter&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="lists" checked> Lists<br>
          <small><code data-hl="html">&lt;dl&gt;</code> <code data-hl="html">&lt;dt&gt;</code> <code data-hl="html">&lt;dd&gt;</code> <code data-hl="html">&lt;ul&gt;</code> <code data-hl="html">&lt;ol&gt;</code> <code data-hl="html">&lt;li&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="tables" checked> Tables<br>
          <small><code data-hl="html">&lt;table&gt;</code> <code data-hl="html">&lt;caption&gt;</code> <code data-hl="html">&lt;tr&gt;</code> <code data-hl="html">&lt;th&gt;</code> <code data-hl="html">&lt;td&gt;</code></small>
        </label>
        <label>
          <input type="checkbox" name="styling" value="media" checked> Media<br>
          <small><code data-hl="html">&lt;img&gt;</code> <code data-hl="html">&lt;video&gt;</code> <code data-hl="html">&lt;iframe&gt;</code></small>
        </label>
      </div>
    </fieldset>
    <fieldset class="extra">
      <legend>
        <label>
          <input type="checkbox" data-for="extra" checked> Extra features
        </label>
      </legend>
      <label>
        <input type="checkbox" name="extra" value="@layouts" checked>
        Layouts<br>
        <small>Include layouts that require specific HTML structures.</small>
      </label>
      <label>
        <input type="checkbox" name="extra" value="@utilities" checked>
        Utilities<br>
        <small>Additional classes as shorthands for colors, display, flash messages, etc.</small>
      </label>
      <label>
        <input type="checkbox" name="extra" value="@syntax-highlighting" checked>
        Syntax highlighting<br>
        <small>Additional classes intended to be used with the <a href="https://highlightjs.org" target="_blank">highlight.js library</a>.</small>
      </label>
      <label>
        <input type="checkbox" name="extra" value="@code-editor" checked>
        Code editor<br>
        <small>Additional classes intended to be used with the <a href="https://highlightjs.org" target="_blank">highlight.js library</a> to create a simple code editor.</small>
      </label>
      <label>
        <input type="checkbox" name="extra" value="@istanbul-coverage">
        Istanbul coverage reports<br>
        <small>Additional classes intended to be used with the <a href="https://istanbul.js.org/" target="_blank">istanbul.js</a> coverage reports.</small>
      </label>
      <label>
        <input type="checkbox" name="extra" value="@discrete-scrollbars" checked>
        Discrete scrollbars<br>
        <small>Style scrollbars for consistant theming (might reduce accessibility).</small>
      </label>
      <label>
        <input type="checkbox" name="extra" value="@break-words" checked>
        Break words<br>
        <small>
          Apply <code data-hl="css">word-break: break-word; hyphens: auto;</code> to several elements to improve text wrapping.
        </small>
      </label>
    </fieldset>
    <details>
      <summary>Customize CSS variables</summary>
      <fieldset class="variables">
        <legend>
          Colors and backgrounds
        </legend>
        <div class="table-responsive">
          <table>
            <tr>
              <th colspan="3">Colors</th>
              <th colspan="3">Backgrounds</th>
              <th rowspan="2">Example usage</th>
            </tr>
            <tr>
              <th>Name</th>
              <th>Light</th>
              <th>Dark</th>
              <th>Name</th>
              <th>Light</th>
              <th>Dark</th>
            </tr>
            <tr>
              <td><code>--default</code></td>
              <td><input type="color" name="--light-default"></td>
              <td><input type="color" name="--dark-default"></td>
              <td><code>--bg-default</code></td>
              <td><input type="color" name="--light-bg-default"></td>
              <td><input type="color" name="--dark-bg-default"></td>
              <td><small class="muted">default text color and background color</small></td>
            </tr>
            <tr>
              <td><code>--contrast</code></td>
              <td><input type="color" name="--light-contrast"></td>
              <td><input type="color" name="--dark-contrast"></td>
              <td><code>--bg-contrast</code></td>
              <td><input type="color" name="--light-bg-contrast"></td>
              <td><input type="color" name="--dark-bg-contrast"></td>
              <td><small class="muted">used to constrast with <code>--default</code></small></td>
            </tr>
            <tr>
              <td><code>--subtle</code></td>
              <td><input type="color" name="--light-subtle"></td>
              <td><input type="color" name="--dark-subtle"></td>
              <td><code>--bg-subtle</code></td>
              <td><input type="color" name="--light-bg-subtle"></td>
              <td><input type="color" name="--dark-bg-subtle"></td>
              <td><small class="muted"><code data-hl="html">&lt;progress&gt;</code> and <code data-hl="html">&lt;meter&gt;</code> backgrounds, etc.</small></td>
            </tr>
            <tr>
              <td><code>--muted</code></td>
              <td><input type="color" name="--light-muted"></td>
              <td><input type="color" name="--dark-muted"></td>
              <td><code>--bg-muted</code></td>
              <td><input type="color" name="--light-bg-muted"></td>
              <td><input type="color" name="--dark-bg-muted"></td>
              <td><small class="muted"><code data-hl="css">.disabled</code>, <code data-hl="html">&lt;caption&gt;</code>, <code data-hl="html">&lt;blockquote&gt;</code>, etc.</small></td>
            </tr>
            <tr>
              <td><code>--accent</code></td>
              <td><input type="color" name="--light-accent"></td>
              <td><input type="color" name="--dark-accent"></td>
              <td><code>--bg-accent</code></td>
              <td><input type="color" name="--light-bg-accent"></td>
              <td><input type="color" name="--dark-bg-accent"></td>
              <td><small class="muted"><code data-hl="css">:hover</code>, <code data-hl="css">.selected</code>, <code data-hl="html">&lt;a&gt;</code>, <code data-hl="html">&lt;button&gt;</code>, etc.</small></td>
            </tr>
            <tr>
              <td><code>--active</code></td>
              <td><input type="color" name="--light-active"></td>
              <td><input type="color" name="--dark-active"></td>
              <td><code>--bg-active</code></td>
              <td><input type="color" name="--light-bg-active"></td>
              <td><input type="color" name="--dark-bg-active"></td>
              <td><small class="muted"><code data-hl="css">:active</code>, <code data-hl="css">:focus</code>, etc.</small></td>
            </tr>
            <tr>
              <td><code>--variant</code></td>
              <td><input type="color" name="--light-variant"></td>
              <td><input type="color" name="--dark-variant"></td>
              <td><code>--bg-variant</code></td>
              <td><input type="color" name="--light-bg-variant"></td>
              <td><input type="color" name="--dark-bg-variant"></td>
              <td><small class="muted">‚Äî</small></td>
            </tr>
            <tr>
              <td><code>--success</code></td>
              <td><input type="color" name="--light-success"></td>
              <td><input type="color" name="--dark-success"></td>
              <td><code>--bg-success</code></td>
              <td><input type="color" name="--light-bg-success"></td>
              <td><input type="color" name="--dark-bg-success"></td>
              <td><small class="muted"><code data-hl="css">:user-valid</code>, <code data-hl="html">&lt;ins&gt;</code>, <code data-hl="html">&lt;meter&gt;</code>'s optimum value, etc.</small></td>
            </tr>
            <tr>
              <td><code>--attention</code></td>
              <td><input type="color" name="--light-attention"></td>
              <td><input type="color" name="--dark-attention"></td>
              <td><code>--bg-attention</code></td>
              <td><input type="color" name="--light-bg-attention"></td>
              <td><input type="color" name="--dark-bg-attention"></td>
              <td><small class="muted"><code data-hl="html">&lt;meter&gt;</code>'s sub-optimum value, etc.</small></td>
            </tr>
            <tr>
              <td><code>--severe</code></td>
              <td><input type="color" name="--light-severe"></td>
              <td><input type="color" name="--dark-severe"></td>
              <td><code>--bg-severe</code></td>
              <td><input type="color" name="--light-bg-severe"></td>
              <td><input type="color" name="--dark-bg-severe"></td>
              <td><small class="muted">‚Äî</small></td>
            </tr>
            <tr>
              <td><code>--danger</code></td>
              <td><input type="color" name="--light-danger"></td>
              <td><input type="color" name="--dark-danger"></td>
              <td><code>--bg-danger</code></td>
              <td><input type="color" name="--light-bg-danger"></td>
              <td><input type="color" name="--dark-bg-danger"></td>
              <td><small class="muted"><code data-hl="css">:user-invalid</code>, <code data-hl="html">&lt;del&gt;</code>, <code data-hl="html">&lt;meter&gt;</code>'s sub-sub-optimum value, <code data-hl="html">&lt;button type="reset"&gt;</code>, etc.</small></td>
            </tr>
          </table>
        </div>
        <footer>
          <button type="reset">Reset to default</button>
        </footer>
      </fieldset>
      <fieldset class="variables">
        <legend>Font related variables</legend>
        <label class="width">
          <code>--ft</code>
          <small>Default font family.</small>
          <small></small>
          <input type="text" name="--ft">
        </label>
        <label class="width">
          <code>--ft-mono</code>
          <small>Default monospaced font family, used in preformatted blocks (e.g. <code data-hl="html">&lt;pre&gt;</code>, <code data-hl="html">&lt;code&gt;</code>, <code data-hl="html">&lt;var&gt;</code>, <code data-hl="html">&lt;samp&gt;</code>, <code data-hl="html">&lt;kbd&gt;</code>, etc.).</small>
          <input type="text" name="--ft-mono">
        </label>
        <label class="width">
          <code>--ft-size</code>
          <small>Default font size <i>(px)</i>.</small>
          <input type="text" name="--ft-size" pattern="^[0-9]+px$">
        </label>
        <footer>
          <button type="reset">Reset to default</button>
        </footer>
      </fieldset>
      <fieldset class="variables">
        <legend>Layouts</legend>
        <p class="muted">
          These variables are only revelant when using a layout from <code>@layouts</code> extra feature.
        </p>
        <label class="width">
          <code>--ly-header-size</code>
          <small>Size of top-level <code data-hl="html">&lt;header&gt;</code>.</small>
          <small></small>
          <input type="text" name="--ly-header-size">
        </label>
        <label class="width">
          <code>--ly-brand</code>
          <small>Text color in top-level <code data-hl="html">&lt;header&gt;</code>.</small>
          <input type="color" name="--ly-brand">
        </label>
        <label class="width">
          <code>--ly-bg-brand</code>
          <small>Background color in top-level <code data-hl="html">&lt;header&gt;</code>.</small>
          <input type="color" name="--ly-bg-brand">
        </label>
        <label class="width">
          <code>--ly-aside-size-small</code>
          <small>Size of main <code data-hl="html">&lt;aside&gt;</code> on small screens.</small>
          <input type="text" name="--ly-aside-size-small">
        </label>
        <footer>
          <button type="reset">Reset to default</button>
        </footer>
      </fieldset>
      <fieldset class="variables">
        <legend>Miscellaneous</legend>
        <label class="width">
          <code>--ct-width</code>
          <small>Maximum container width <i>(px)</i> for sectioning elements that act as containers (e.g. <code data-hl="html">&lt;section&gt;</code>, etc.).</small>
          <input type="text" name="--ct-width" pattern="^[0-9]+px$">
        </label>
        <label class="width">
          <code>--bd-radius</code>
          <small>Border radius basis <i>(px)</i>.</small>
          <input type="text" name="--bd-radius" pattern="^[0-9]+px$">
        </label>
        <label class="width">
          <code>--tr-duration</code>
          <small>Transition duration basis <i>(s)</i>.</small>
          <input type="text" name="--tr-duration" pattern="^[.0-9]+s$">
        </label>
        <hr>
        <div class="table-responsive">
          <table>
            <tr>
              <th rowspan="2">Name</th>
              <th colspan="2">Light</th>
              <th colspan="2">Dark</th>
              <th rowspan="2">Example usage</th>
            </tr>
            <tr>
              <th>Color</th>
              <th>Alpha</th>
              <th>Color</th>
              <th>Alpha</th>
            </tr>
            <tr>
              <td><code>--backdrop</code></td>
              <td><input type="color" name="--light-backdrop"></td>
              <td><input type="text" name="--light-backdrop@opacity"></td>
              <td><input type="color" name="--dark-backdrop"></td>
              <td><input type="text" name="--dark-backdrop@opacity"></td>
              <td><small class="muted"><code data-hl="css">dialog::backdrop</code>, <code data-hl="css">--shadow</code>, etc.</small></td>
            </tr>
            <tr>
              <td><code>--bd-muted</code></td>
              <td><input type="color" name="--light-bd-muted"></td>
              <td><input type="text" name="--light-bd-muted@opacity"></td>
              <td><input type="color" name="--dark-bd-muted"></td>
              <td><input type="text" name="--dark-bd-muted@opacity"></td>
              <td><small class="muted"><code data-hl="html">&lt;td&gt;</code>, <code data-hl="html">&lt;th&gt;</code>, <code data-hl="html">&lt;article&gt;</code>, <code data-hl="html">&lt;blockquote&gt;</code>, <code data-hl="html">&lt;fieldset&gt;</code>, <code data-hl="html">&lt;input&gt;</code>, <code data-hl="html">&lt;select&gt;</code>, <code data-hl="html">&lt;textarea&gt;</code>, etc.</code></small></td>
            </tr>
          </table>
        </div>
        <footer>
          <button type="reset">Reset to default</button>
        </footer>
      </fieldset>
    </details>
    <fieldset>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
      <legend>Customization</legend>
      <label class="width">
        Extra CSS content
        <small>
          Append your own custom CSS styles to the final build without the need to fork the project.
          You can use <a href="https://developer.mozilla.org/docs/Web/CSS/important"><code data-hl="css">!important</code></a> rules
          when needed to ensure your styles are applied since <em>matcha.css</em> never uses this priority level.
        </small>
        <div class="editor mt-.5">
          <textarea rows="8" name="custom">/** Your custom extra CSS here */</textarea>
          <div class="highlight"></div>
        </div>
        <script>
          {
            const editor = document.currentScript.previousElementSibling
            const textarea = editor.querySelector("textarea")
            const highlight = editor.querySelector(".highlight")
            textarea.addEventListener("input", () => coloration(textarea.value))
            textarea.addEventListener("scroll", function () {
              highlight.scrollTop = this.scrollTop
              highlight.scrollLeft = this.scrollLeft
            })
            function coloration(value) {
              highlight.innerHTML = hljs.highlight(value, { language: "css" }).value
            }
            coloration(textarea.value)
          }
        </script>
      </label>
    </fieldset>
    <fieldset class="miscellaneous">
      <legend>Miscellaneous</legend>
      <label>
        <input type="checkbox" name="minify" checked>
        Minify<br>
        <small>
          Minify CSS to reduce final bundle size.
          It requires a call to a serverless function that may fail because of a time-limit or rate-limit, if you're having issues
          with getting your custom build, try disabling this option.
        </small>
      </label>
    </fieldset>
    <fieldset class="preview accent">
      <legend>Preview</legend>
      <p>
        Preview your custom build to ensure it fits your taste.
      </p>
      <menu class="example-tabs">
        <li class="color-scheme">
          <svg class="light" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M8 12a4 4 0 1 1 0-8 4 4 0 0 1 0 8Zm0-1.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm5.657-8.157a.75.75 0 0 1 0 1.061l-1.061 1.06a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l1.06-1.06a.75.75 0 0 1 1.06 0Zm-9.193 9.193a.75.75 0 0 1 0 1.06l-1.06 1.061a.75.75 0 1 1-1.061-1.06l1.06-1.061a.75.75 0 0 1 1.061 0ZM8 0a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 8 0ZM3 8a.75.75 0 0 1-.75.75H.75a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 3 8Zm13 0a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 16 8Zm-8 5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 8 13Zm3.536-1.464a.75.75 0 0 1 1.06 0l1.061 1.06a.75.75 0 0 1-1.06 1.061l-1.061-1.06a.75.75 0 0 1 0-1.061ZM2.343 2.343a.75.75 0 0 1 1.061 0l1.06 1.061a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018l-1.06-1.06a.75.75 0 0 1 0-1.06Z"></path></svg>
          <svg class="dark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M9.598 1.591a.749.749 0 0 1 .785-.175 7.001 7.001 0 1 1-8.967 8.967.75.75 0 0 1 .961-.96 5.5 5.5 0 0 0 7.046-7.046.75.75 0 0 1 .175-.786Zm1.616 1.945a7 7 0 0 1-7.678 7.678 5.499 5.499 0 1 0 7.678-7.678Z"></path></svg>
        </li>
      </menu>
      <iframe class="matcha-preview" loading="lazy" title="build preview" height="420" class="bd-muted"></iframe>
      <footer>
        <button class="accent">Preview</button>
      </footer>
    </fieldset>
    <fieldset class="brewing success">
      <legend>Brew matcha!</legend>
      <p>
        Ready to brew your custom matcha?
        Click the button below to get started!
      </p>
      <footer>
        <button class="success">üçµ Get your brewed matcha!</button>
      </footer>
    </fieldset>
    <p class="flash danger brewing-error hidden"></p>
  </form>
  <script>
    {
      const banner = [
        "/**",
        ` * matcha.css ‚Äî Custom build (${new Date().toDateString()})`,
        ` * Copyright ¬© ${new Date().getFullYear()} Lecoq Simon (@lowlighter)`,
        " * MIT license ‚Äî https://github.com/lowlighter/matcha",
        " */"
      ].join("\n")
      const form = document.currentScript.previousElementSibling
      // Manage meta-checkboxes
      form.querySelectorAll("legend input").forEach(input => {
        input.addEventListener("change", () => {
          form.querySelectorAll(`input[name="${input.dataset.for}"]`).forEach(child => child.checked = input.checked)
        })
      })
      // Manage checkboxes
      form.querySelectorAll('input[type="checkbox"]').forEach(input => {
        if (input.name) {
          input.addEventListener("change", () => {
            const checked = Array.from(form.querySelectorAll(`input[name="${input.name}"]`)).reduce((checked, input) => checked && input.checked, true)
            form.querySelector(`input[data-for="${input.name}"]`).checked = checked
          })
        }
      })
      // Manage variables
      function reset(element) {
        element.querySelectorAll("input[name]").forEach(input => {
          if ((!input.name)||(input.name.endsWith("@opacity")))
            return
          let value = getComputedStyle(element).getPropertyValue(input.name)
          if ((input.type === "color")&&(/^#[a-f0-9]{8}$/i.test(value))) {
            const [color, opacity] = [value.slice(0, 7), value.slice(7)]
            value = color
            element.querySelector(`input[name="${input.name}@opacity"]`).value = opacity
            element.querySelector(`input[name="${input.name}@opacity"]`).dataset.default = opacity
          }
          input.value = value
          input.dataset.default = value
        })
      }
      form.querySelectorAll('.variables button[type="reset"]').forEach(button => button.addEventListener("click", event => {
        event.preventDefault()
        reset(button.closest(".variables"))
      }))
      form.querySelectorAll(".variables").forEach(group => reset(group))
      // Manage preview
      const preview = form.querySelector(".preview button")
      preview.addEventListener("click", async event => {
        event.preventDefault()
        const iframe = form.querySelector(".preview iframe")
        iframe.src = "/build/demo"
        iframe.onload = async function() {
          const style = iframe.contentDocument.createElement("style")
          style.innerText = await brew()
          iframe.contentDocument.head.appendChild(style)
        }
      })
      // Manage brewing
      const brewing = form.querySelector(".brewing button")
      const teapot = {styling:[], extra:[], variables:[]}
      form.addEventListener("change", () => {
        const styling = Array.from(form.querySelectorAll('input[name="styling"]'))
        const extra = Array.from(form.querySelectorAll('input[name="extra"]'))
        const variables = Array.from(form.querySelectorAll('.variables input'))
        Object.assign(teapot, {
          styling:styling.filter(({checked}) => checked).map(({value}) => value),
          extra:extra.filter(({checked}) => checked).map(({value}) => value),
          variables:variables.filter(({name, value, dataset}) => (!name.endsWith("@opacity"))&&(value !== dataset.default)).map(({name, value}) => ({name, value}))
        })
        variables.filter(({name, value, dataset}) => (name.endsWith("@opacity"))&&(value !== dataset.default)).forEach(({name, value:opacity}) => {
          const color = form.querySelector(`input[name="${name.replace("@opacity", "")}"]`).value
          if (!teapot.variables.find(variable => variable.name === name.replace("@opacity", "")))
            teapot.variables.push({name:name.replace("@opacity", ""), value:`${color}${opacity}`})
          teapot.variables.find(variable => variable.name === name.replace("@opacity", "")).value = `${color}${opacity}`
        })
      })
      async function brew() {
        const custom = form.querySelector('textarea[name="custom"]').value
        const root = await fetch("/styles/@root/mod.css").then(response => response.text())
        const parts = await Promise.all([...teapot.styling, ...teapot.extra].sort((a, b) => a.localeCompare(b)).map(async name => await fetch(`/styles/${name}/mod.css`).then(response  => response.text())))
        if (teapot.variables.length) {
          const [_, defined, computed] = root.match(/^(?<defined>:root\s*\{[\s\S]*?\})(?<computed>[\s\S*]*)$/)
          const stylesheet = new CSSStyleSheet()
          stylesheet.insertRule(defined)
          for (const {name, value} of teapot.variables) {
            stylesheet.rules[0].style.setProperty(name, value)
          }
          parts.unshift(stylesheet.rules[0].cssText, computed)
        }
        else {
          parts.unshift(root)
        }
        return [banner, ...parts, custom.trim()].join("\n")
      }
      // Manage brewed download
      form.querySelector(".brewing button").addEventListener("click", async event => {
        event.preventDefault()
        const minify = form.querySelector('input[name="minify"]').checked
        const stylesheet = await brew()
        try {
          brewing.toggleAttribute("disabled", true)
          brewing.style.cursor = "loading"
          let url = URL.createObjectURL(new Blob([new TextEncoder().encode(stylesheet)], {type:"text/css;charset=utf-8"}))
          if (minify) {
            const response = await fetch("/api/brew", {method:"POST", body:stylesheet})
            if (response.status !== 200) {
              throw new Error(await response.text())
            }
            url = URL.createObjectURL(new Blob([await response.blob()], {type:"text/css;charset=utf-8"}))
          }
          globalThis.open(url, "_blank")
        }
        catch (error) {
          document.querySelector(".brewing-error").classList.remove("hidden")
          document.querySelector(".brewing-error").innerText = error.message
          setTimeout(() => document.querySelector(".brewing-error").classList.add("hidden"), 15*1000)
        }
        finally {
          brewing.toggleAttribute("disabled", false)
          brewing.style.removeProperty("cursor")
        }
      })
      form.dispatchEvent(new Event("change"))
    }
  </script>
</details>